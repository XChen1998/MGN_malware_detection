<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>NPF functions</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc3 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="modules.html">Modules</a> &nbsp; <a class="qindex" href="annotated.html">Data Structures</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Data Fields</a> &nbsp; <a class="qindex" href="globals.html">Globals</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>NPF functions<br>
<small>
[<a class="el" href="group__NPF.html">NPF driver internals manual</a>]</small>
</h1><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a0">DriverEntry</a> (IN PDRIVER_OBJECT DriverObject, IN PUNICODE_STRING RegistryPath)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>The initialization routine of the driver.</em> <a href="#a0"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>PWCHAR&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a1">getAdaptersList</a> (VOID)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Returns the list of the MACs available on the system.</em> <a href="#a1"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>PKEY_VALUE_PARTIAL_INFORMATION&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a2">getTcpBindings</a> (VOID)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Returns the MACs that bind to TCP/IP.</em> <a href="#a2"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>BOOLEAN&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a3">createDevice</a> (IN OUT PDRIVER_OBJECT adriverObjectP, IN PUNICODE_STRING amacNameP, NDIS_HANDLE aProtoHandle)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Creates a device for a given MAC.</em> <a href="#a3"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a4">NPF_Open</a> (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Opens a new instance of the driver.</em> <a href="#a4"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a5">NPF_OpenAdapterComplete</a> (IN NDIS_HANDLE ProtocolBindingContext, IN NDIS_STATUS Status, IN NDIS_STATUS OpenErrorStatus)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Ends the opening of an adapter.</em> <a href="#a5"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a6">NPF_Close</a> (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Closes an instance of the driver.</em> <a href="#a6"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a7">NPF_CloseAdapterComplete</a> (IN NDIS_HANDLE ProtocolBindingContext, IN NDIS_STATUS Status)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Ends the closing of an adapter.</em> <a href="#a7"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NDIS_STATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a8">NPF_tap</a> (IN NDIS_HANDLE ProtocolBindingContext, IN NDIS_HANDLE MacReceiveContext, IN PVOID HeaderBuffer, IN UINT HeaderBufferSize, IN PVOID LookAheadBuffer, IN UINT LookaheadBufferSize, IN UINT PacketSize)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Callback invoked by NDIS when a packet arrives from the network.</em> <a href="#a8"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a9">NPF_TransferDataComplete</a> (IN NDIS_HANDLE ProtocolBindingContext, IN PNDIS_PACKET Packet, IN NDIS_STATUS Status, IN UINT BytesTransferred)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Ends the transfer of a packet.</em> <a href="#a9"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a10">NPF_ReceiveComplete</a> (IN NDIS_HANDLE ProtocolBindingContext)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Callback function that signals the end of a packet reception.</em> <a href="#a10"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a11">NPF_IoControl</a> (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Handles the IOCTL calls.</em> <a href="#a11"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a12">NPF_RequestComplete</a> (IN NDIS_HANDLE ProtocolBindingContext, IN PNDIS_REQUEST pRequest, IN NDIS_STATUS Status)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Ends an OID request.</em> <a href="#a12"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a13">NPF_Write</a> (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Writes a raw packet to the network.</em> <a href="#a13"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>INT&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a14">NPF_BufferedWrite</a> (IN PIRP Irp, IN PCHAR UserBuff, IN ULONG UserBuffSize, BOOLEAN sync)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Writes a buffer of raw packets to the network.</em> <a href="#a14"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a15">NPF_SendComplete</a> (IN NDIS_HANDLE ProtocolBindingContext, IN PNDIS_PACKET pPacket, IN NDIS_STATUS Status)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Ends a send operation.</em> <a href="#a15"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a16">NPF_ResetComplete</a> (IN NDIS_HANDLE ProtocolBindingContext, IN NDIS_STATUS Status)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Ends a reset of the adapter.</em> <a href="#a16"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a17">NPF_Status</a> (IN NDIS_HANDLE ProtocolBindingContext, IN NDIS_STATUS Status, IN PVOID StatusBuffer, IN UINT StatusBufferSize)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Callback for NDIS StatusHandler. Not used by NPF.</em> <a href="#a17"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a18">NPF_StatusComplete</a> (IN NDIS_HANDLE ProtocolBindingContext)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Callback for NDIS StatusCompleteHandler. Not used by NPF.</em> <a href="#a18"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a19">NPF_Unload</a> (IN PDRIVER_OBJECT DriverObject)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Function called by the OS when NPF is unloaded.</em> <a href="#a19"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a20">NPF_Read</a> (IN PDEVICE_OBJECT DeviceObject, IN PIRP Irp)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Function that serves the user's reads.</em> <a href="#a20"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a21">NPF_ReadRegistry</a> (IN PWSTR *MacDriverName, IN PWSTR *PacketDriverName, IN PUNICODE_STRING RegistryPath)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Reads the registry keys associated woth NPF if the driver is manually installed via the control panel.</em> <a href="#a21"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a22">NPF_QueryRegistryRoutine</a> (IN PWSTR ValueName, IN ULONG ValueType, IN PVOID ValueData, IN ULONG ValueLength, IN PVOID Context, IN PVOID EntryContext)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Function used by <a class="el" href="group__NPF__code.html#a21">NPF_ReadRegistry()</a> to quesry the registry keys associated woth NPF if the driver is manually installed via the control panel.</em> <a href="#a22"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a23">NPF_BindAdapter</a> (OUT PNDIS_STATUS Status, IN NDIS_HANDLE BindContext, IN PNDIS_STRING DeviceName, IN PVOID SystemSpecific1, IN PVOID SystemSpecific2)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Callback for NDIS BindAdapterHandler. Not used by NPF.</em> <a href="#a23"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a24">NPF_UnbindAdapter</a> (OUT PNDIS_STATUS Status, IN NDIS_HANDLE ProtocolBindingContext, IN NDIS_HANDLE UnbindContext)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Callback for NDIS UnbindAdapterHandler.</em> <a href="#a24"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>int&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a25">bpf_validate</a> (struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *f, int len, <a class="el" href="group__remote__pri__struct.html#a2">uint32</a> mem_ex_size)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Validates a filtering program arriving from the user-level app.</em> <a href="#a25"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>UINT&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a26">bpf_filter</a> (register struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *pc, register UCHAR *p, UINT wirelen, register UINT buflen, PMEM_TYPE mem_ex, PTME_CORE tme, struct time_conv *time_ref)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>The filtering pseudo-machine interpreter.</em> <a href="#a26"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>UINT&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a27">bpf_filter_with_2_buffers</a> (register struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *pc, register UCHAR *p, register UCHAR *pd, register int headersize, UINT wirelen, register UINT buflen, PMEM_TYPE mem_ex, PTME_CORE tme, struct time_conv *time_ref)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>The filtering pseudo-machine interpreter with two buffers. This function is slower than <a class="el" href="group__NPF__code.html#a26">bpf_filter()</a>, but works correctly also if the MAC header and the data of the packet are in two different buffers.</em> <a href="#a27"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a28">NPF_OpenDumpFile</a> (<a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a> Open, PUNICODE_STRING fileName, BOOLEAN append)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Creates the file that will receive the packets when the driver is in dump mode.</em> <a href="#a28"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a29">NPF_StartDump</a> (<a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a> Open)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Starts dump to file.</em> <a href="#a29"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a30">NPF_DumpThread</a> (PVOID Open)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>The dump thread.</em> <a href="#a30"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a31">NPF_SaveCurrentBuffer</a> (<a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a> Open)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Saves the content of the packet buffer to the file associated with current instance.</em> <a href="#a31"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>VOID&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a32">NPF_WriteDumpFile</a> (PFILE_OBJECT FileObject, PLARGE_INTEGER Offset, ULONG Length, PMDL Mdl, PIO_STATUS_BLOCK IoStatusBlock)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Writes a block of packets on the dump file.</em> <a href="#a32"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>NTSTATUS&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a33">NPF_CloseDumpFile</a> (<a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a> Open)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Closes the dump file associated with an instance of the driver.</em> <a href="#a33"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>UINT&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a34">GetBuffOccupation</a> (<a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a> Open)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Returns the amount of bytes present in the packet buffer.</em> <a href="#a34"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="structJIT__BPF__Filter.html">JIT_BPF_Filter</a> *&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a35">BPF_jitter</a> (struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *fp, INT nins)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>BPF jitter, builds an x86 function from a BPF program.</em> <a href="#a35"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top><a class="el" href="group__NPF__include.html#a10">BPF_filter_function</a>&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a36">BPFtoX86</a> (struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *prog, UINT nins, INT *mem)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Translates a set of BPF instructions in a set of x86 ones.</em> <a href="#a36"></a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>void&nbsp;</td><td valign=bottom><a class="el" href="group__NPF__code.html#a37">BPF_Destroy_JIT_Filter</a> (<a class="el" href="structJIT__BPF__Filter.html">JIT_BPF_Filter</a> *Filter)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Deletes a filtering function that was previously created by <a class="el" href="group__NPF__code.html#a35">BPF_jitter()</a>.</em> <a href="#a37"></a><em></em></font><br><br></td></tr>
</table>
<hr><h2>Function Documentation</h2>
<a name="a37" doxytag="jitter.c::BPF_Destroy_JIT_Filter"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void BPF_Destroy_JIT_Filter </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structJIT__BPF__Filter.html">JIT_BPF_Filter</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>Filter</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Deletes a filtering function that was previously created by <a class="el" href="group__NPF__code.html#a35">BPF_jitter()</a>.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Filter</em>&nbsp;</td><td>The filter to destroy.</td></tr>
  </table>
</dl>
This function frees the variuos buffers (code, memory, etc.) associated with a filtering function. 
<p>
Definition at line <a class="el" href="jitter_8c-source.html#l00659">659</a> of file <a class="el" href="jitter_8c-source.html">jitter.c</a>.
<p>
References <a class="el" href="jitter_8h-source.html#l00084">JIT_BPF_Filter::Function</a>, and <a class="el" href="jitter_8h-source.html#l00085">JIT_BPF_Filter::mem</a>.
<p>
Referenced by <a class="el" href="Openclos_8c-source.html#l00380">NPF_Close()</a>, <a class="el" href="Openclos_8c-source.html#l00492">NPF_CloseAdapterComplete()</a>, and <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>.    </td>
  </tr>
</table>
<a name="a26" doxytag="Packet.h::bpf_filter"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT bpf_filter </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">register struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>pc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register UCHAR *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>p</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>wirelen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>buflen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PMEM_TYPE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>mem_ex</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PTME_CORE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tme</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct time_conv *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>time_ref</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The filtering pseudo-machine interpreter.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>pc</em>&nbsp;</td><td>The filter. </td></tr>
    <tr><td valign=top><em>p</em>&nbsp;</td><td>Pointer to a memory buffer containing the packet on which the filter will be executed. </td></tr>
    <tr><td valign=top><em>wirelen</em>&nbsp;</td><td>Original length of the packet. </td></tr>
    <tr><td valign=top><em>buflen</em>&nbsp;</td><td>Current length of the packet. In some cases (for example when the transfer of the packet to the RAM has not yet finished), bpf_filter can be executed on a portion of the packet. </td></tr>
    <tr><td valign=top><em>mem_ex</em>&nbsp;</td><td>The extended memory. </td></tr>
    <tr><td valign=top><em>tme</em>&nbsp;</td><td>The virtualization of the TME co-processor </td></tr>
    <tr><td valign=top><em>time_ref</em>&nbsp;</td><td>Data structure needed by the TME co-processor to timestamp data </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The portion of the packet to keep, in bytes. 0 means that the packet must be rejected, -1 means that the whole packet must be kept.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>this function is not used in normal situations, because the jitter creates a native filtering function that is faster than the interpreter. </dd></dl>

<p>
Referenced by <a class="el" href="Read_8c-source.html#l00297">NPF_tap()</a>, and <a class="el" href="savefile_8c-source.html#l00619">pcap_offline_read()</a>.    </td>
  </tr>
</table>
<a name="a27" doxytag="Packet.h::bpf_filter_with_2_buffers"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT bpf_filter_with_2_buffers </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">register struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>pc</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register UCHAR *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>p</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register UCHAR *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>pd</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register int&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>headersize</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>wirelen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>register UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>buflen</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PMEM_TYPE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>mem_ex</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PTME_CORE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>tme</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct time_conv *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>time_ref</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The filtering pseudo-machine interpreter with two buffers. This function is slower than <a class="el" href="group__NPF__code.html#a26">bpf_filter()</a>, but works correctly also if the MAC header and the data of the packet are in two different buffers.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>pc</em>&nbsp;</td><td>The filter. </td></tr>
    <tr><td valign=top><em>p</em>&nbsp;</td><td>Pointer to a memory buffer containing the MAC header of the packet. </td></tr>
    <tr><td valign=top><em>pd</em>&nbsp;</td><td>Pointer to a memory buffer containing the data of the packet. </td></tr>
    <tr><td valign=top><em>wirelen</em>&nbsp;</td><td>Original length of the packet. </td></tr>
    <tr><td valign=top><em>buflen</em>&nbsp;</td><td>Current length of the packet. In some cases (for example when the transfer of the packet to the RAM has not yet finished), bpf_filter can be executed on a portion of the packet. </td></tr>
    <tr><td valign=top><em>mem_ex</em>&nbsp;</td><td>The extended memory. </td></tr>
    <tr><td valign=top><em>tme</em>&nbsp;</td><td>The virtualization of the TME co-processor </td></tr>
    <tr><td valign=top><em>time_ref</em>&nbsp;</td><td>Data structure needed by the TME co-processor to timestamp data </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The portion of the packet to keep, in bytes. 0 means that the packet must be rejected, -1 means that the whole packet must be kept.</dd></dl>
This function is used when NDIS passes the packet to <a class="el" href="group__NPF__code.html#a8">NPF_tap()</a> in two buffers instaed than in a single one. 
<p>
Referenced by <a class="el" href="Read_8c-source.html#l00297">NPF_tap()</a>.    </td>
  </tr>
</table>
<a name="a35" doxytag="jitter.c::BPF_jitter"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="structJIT__BPF__Filter.html">JIT_BPF_Filter</a>* BPF_jitter </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>fp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>INT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>nins</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
BPF jitter, builds an x86 function from a BPF program.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>fp</em>&nbsp;</td><td>The BPF pseudo-assembly filter that will be translated into x86 code. </td></tr>
    <tr><td valign=top><em>nins</em>&nbsp;</td><td>Number of instructions of the input filter. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The <a class="el" href="structJIT__BPF__Filter.html">JIT_BPF_Filter</a> structure containing the x86 filtering binary.</dd></dl>
BPF_jitter allocates the buffers for the new native filter and then translates the program pointed by fp calling <a class="el" href="group__NPF__code.html#a36">BPFtoX86()</a>. 
<p>
Definition at line <a class="el" href="jitter_8c-source.html#l00608">608</a> of file <a class="el" href="jitter_8c-source.html">jitter.c</a>.
<p>
References <a class="el" href="jitter_8c-source.html#l00075">BPFtoX86()</a>, <a class="el" href="jitter_8h.html#a12">JIT_BPF_Filter</a>, and <a class="el" href="jitter_8h-source.html#l00085">JIT_BPF_Filter::mem</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>.    </td>
  </tr>
</table>
<a name="a25" doxytag="Packet.h::bpf_validate"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int bpf_validate </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>f</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>len</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="group__remote__pri__struct.html#a2">uint32</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>mem_ex_size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Validates a filtering program arriving from the user-level app.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>f</em>&nbsp;</td><td>The filter. </td></tr>
    <tr><td valign=top><em>len</em>&nbsp;</td><td>Its length, in pseudo instructions. </td></tr>
    <tr><td valign=top><em>mem_ex_size</em>&nbsp;</td><td>The length of the extended memory, used to validate LD/ST to that memory </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>true if f is a valid filter program..</dd></dl>
The kernel needs to be able to verify an application's filter code. Otherwise, a bogus program could easily crash the system. This function returns true if f is a valid filter program. The constraints are that each jump be forward and to a valid code. The code must terminate with either an accept or reject. 
<p>
Referenced by <a class="el" href="daemon_8c-source.html#l01147">daemon_unpackapplyfilter()</a>, and <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>.    </td>
  </tr>
</table>
<a name="a36" doxytag="jitter.c::BPFtoX86"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="group__NPF__include.html#a10">BPF_filter_function</a> BPFtoX86 </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structbpf__insn.html">bpf_insn</a> *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ins</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>nins</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>INT *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>mem</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Translates a set of BPF instructions in a set of x86 ones.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ins</em>&nbsp;</td><td>Pointer to the BPF instructions that will be translated into x86 code. </td></tr>
    <tr><td valign=top><em>nins</em>&nbsp;</td><td>Number of instructions to translate. </td></tr>
    <tr><td valign=top><em>mem</em>&nbsp;</td><td>Memory used by the x86 function to emulate the RAM of the BPF pseudo processor. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The x86 filtering function.</dd></dl>
This function does the hard work for the JIT compilation. It takes a group of BPF pseudo instructions and through the instruction macros defined in <a class="el" href="jitter_8h.html">jitter.h</a> it is able to create an function directly executable by NPF. 
<p>
Definition at line <a class="el" href="jitter_8c-source.html#l00075">75</a> of file <a class="el" href="jitter_8c-source.html">jitter.c</a>.
<p>
References <a class="el" href="jitter_8h-source.html#l00163">ADD_EAXi</a>, <a class="el" href="jitter_8h-source.html#l00174">ADDib</a>, <a class="el" href="jitter_8h-source.html#l00158">ADDrd</a>, <a class="el" href="jitter_8h-source.html#l00200">ANDib</a>, <a class="el" href="jitter_8h-source.html#l00206">ANDid</a>, <a class="el" href="jitter_8h-source.html#l00216">ANDrd</a>, <a class="el" href="jitter_8h-source.html#l00070">BPF_filter_function</a>, <a class="el" href="jitter_8h-source.html#l00059">binary_stream::bpf_pc</a>, <a class="el" href="jitter_8h-source.html#l00136">BSWAP</a>, <a class="el" href="jitter_8h-source.html#l00274">CMPid</a>, <a class="el" href="jitter_8h-source.html#l00263">CMPodd</a>, <a class="el" href="jitter_8h-source.html#l00269">CMPrd</a>, <a class="el" href="Packet32_8h-source.html#l00114">bpf_insn::code</a>, <a class="el" href="jitter_8h-source.html#l00058">binary_stream::cur_ip</a>, <a class="el" href="jitter_8h-source.html#l00195">DIVrd</a>, <a class="el" href="jitter_8c-source.html#l00044">emit_code()</a>, <a class="el" href="jitter_8c-source.html#l00035">emit_lenght()</a>, <a class="el" href="jitter_8c-source.html#l00030">emitm</a>, <a class="el" href="jitter_8h-source.html#l00060">binary_stream::ibuf</a>, <a class="el" href="jitter_8h-source.html#l00306">JA</a>, <a class="el" href="jitter_8h-source.html#l00312">JAE</a>, <a class="el" href="jitter_8h-source.html#l00289">JE</a>, <a class="el" href="Packet32_8h-source.html#l00116">bpf_insn::jf</a>, <a class="el" href="jitter_8h-source.html#l00318">JG</a>, <a class="el" href="jitter_8h-source.html#l00324">JGE</a>, <a class="el" href="jitter_8h-source.html#l00301">JLEb</a>, <a class="el" href="jitter_8h-source.html#l00330">JMP</a>, <a class="el" href="jitter_8h-source.html#l00284">JNEb</a>, <a class="el" href="Packet32_8h-source.html#l00115">bpf_insn::jt</a>, <a class="el" href="Packet32_8h-source.html#l00117">bpf_insn::k</a>, <a class="el" href="jitter_8h-source.html#l00097">MOVid</a>, <a class="el" href="jitter_8h-source.html#l00124">MOVobb</a>, <a class="el" href="jitter_8h-source.html#l00111">MOVobd</a>, <a class="el" href="jitter_8h-source.html#l00117">MOVobw</a>, <a class="el" href="jitter_8h-source.html#l00105">MOVodd</a>, <a class="el" href="jitter_8h-source.html#l00130">MOVomd</a>, <a class="el" href="jitter_8h-source.html#l00101">MOVrd</a>, <a class="el" href="jitter_8h-source.html#l00190">MULrd</a>, <a class="el" href="jitter_8h-source.html#l00258">NEGd</a>, <a class="el" href="jitter_8h-source.html#l00226">ORid</a>, <a class="el" href="jitter_8h-source.html#l00221">ORrd</a>, <a class="el" href="jitter_8h-source.html#l00150">POP</a>, <a class="el" href="jitter_8h-source.html#l00146">PUSH</a>, <a class="el" href="jitter_8h-source.html#l00061">binary_stream::refs</a>, <a class="el" href="jitter_8h-source.html#l00154">RET</a>, <a class="el" href="jitter_8h-source.html#l00242">SHL_CLrb</a>, <a class="el" href="jitter_8h-source.html#l00236">SHLib</a>, <a class="el" href="jitter_8h-source.html#l00253">SHR_CLrb</a>, <a class="el" href="jitter_8h-source.html#l00247">SHRib</a>, <a class="el" href="jitter_8h-source.html#l00185">SUB_EAXi</a>, <a class="el" href="jitter_8h-source.html#l00180">SUBrd</a>, and <a class="el" href="jitter_8h-source.html#l00141">SWAP_AX</a>.
<p>
Referenced by <a class="el" href="jitter_8c-source.html#l00608">BPF_jitter()</a>.    </td>
  </tr>
</table>
<a name="a3" doxytag="Packet.h::createDevice"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN createDevice </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PDRIVER_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>adriverObjectP</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>amacNameP</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>aProtoHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Creates a device for a given MAC.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>adriverObjectP</em>&nbsp;</td><td>The driver object that will be associated with the device, i.e. the one of NPF. </td></tr>
    <tr><td valign=top><em>amacNameP</em>&nbsp;</td><td>The name of the network interface that the device will point. </td></tr>
    <tr><td valign=top><em>aProtoHandle</em>&nbsp;</td><td>NDIS protocol handle of NPF. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>If the function succeeds, the return value is nonzero.</dd></dl>
NPF creates a device for every valid network adapter. The new device points to the NPF driver, but contains information about the original device. In this way, when the user opens the new device, NPF will be able to determine the correct adapter to use. 
<p>
Definition at line <a class="el" href="Packet_8c-source.html#l00394">394</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00260">_DEVICE_EXTENSION::AdapterName</a>, <a class="el" href="Packet_8c-source.html#l00048">devicePrefix</a>, <a class="el" href="Packet_8h-source.html#l00261">_DEVICE_EXTENSION::ExportString</a>, <a class="el" href="Packet_8h-source.html#l00259">_DEVICE_EXTENSION::NdisProtocolHandle</a>, <a class="el" href="Packet_8c-source.html#l00047">NPF_Prefix</a>, and <a class="el" href="Packet_8c-source.html#l00049">symbolicLinkPrefix</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a0" doxytag="Packet.h::DriverEntry"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DriverEntry </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDRIVER_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>DriverObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>RegistryPath</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The initialization routine of the driver.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DriverObject</em>&nbsp;</td><td>The driver object of NPF created by the system. </td></tr>
    <tr><td valign=top><em>RegistryPath</em>&nbsp;</td><td>The registry path containing the keys related to the driver. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>A string containing a list of network adapters.</dd></dl>
DriverEntry is a mandatory function in a device driver. Like the <a class="el" href="pcap__filter_8c.html#a4">main()</a> of a user level program, it is called by the system when the driver is loaded in memory and started. Its purpose is to initialize the driver, performing all the allocations and the setup. In particular, DriverEntry registers all the driver's I/O callbacks, creates the devices, defines NPF as a protocol inside NDIS. 
<p>
Definition at line <a class="el" href="Packet_8c-source.html#l00070">70</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
References <a class="el" href="Packet_8c-source.html#l00058">bindP</a>, <a class="el" href="Packet_8c-source.html#l00394">createDevice()</a>, <a class="el" href="Packet_8c-source.html#l00195">getAdaptersList()</a>, <a class="el" href="Packet_8c-source.html#l00322">getTcpBindings()</a>, <a class="el" href="Packet_8c-source.html#l00064">NCpu</a>, <a class="el" href="Openclos_8c-source.html#l00577">NPF_BindAdapter()</a>, <a class="el" href="Openclos_8c-source.html#l00380">NPF_Close()</a>, <a class="el" href="Openclos_8c-source.html#l00492">NPF_CloseAdapterComplete()</a>, <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>, <a class="el" href="Openclos_8c-source.html#l00066">NPF_Open()</a>, <a class="el" href="Openclos_8c-source.html#l00277">NPF_OpenAdapterComplete()</a>, <a class="el" href="Read_8c-source.html#l00037">NPF_Read()</a>, <a class="el" href="Read_8c-source.html#l00876">NPF_ReceiveComplete()</a>, <a class="el" href="Packet_8c-source.html#l01128">NPF_RequestComplete()</a>, <a class="el" href="Openclos_8c-source.html#l00648">NPF_ResetComplete()</a>, <a class="el" href="Write_8c-source.html#l00298">NPF_SendComplete()</a>, <a class="el" href="Packet_8c-source.html#l01213">NPF_Status()</a>, <a class="el" href="Packet_8c-source.html#l01231">NPF_StatusComplete()</a>, <a class="el" href="Read_8c-source.html#l00297">NPF_tap()</a>, <a class="el" href="Read_8c-source.html#l00807">NPF_TransferDataComplete()</a>, <a class="el" href="Openclos_8c-source.html#l00591">NPF_UnbindAdapter()</a>, <a class="el" href="Packet_8c-source.html#l00495">NPF_Unload()</a>, and <a class="el" href="Write_8c-source.html#l00034">NPF_Write()</a>.    </td>
  </tr>
</table>
<a name="a1" doxytag="Packet.h::getAdaptersList"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWCHAR getAdaptersList </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the list of the MACs available on the system.
<p>
<dl compact><dt><b>Returns:</b></dt><dd>A string containing a list of network adapters.</dd></dl>
The list of adapters is retrieved from the SYSTEM\{4D36E972-E325-11CE-BFC1-08002BE10318} registry key. NPF tries to create its bindings from this list. In this way it is possible to be loaded and unloaded dynamically without passing from the control panel.     </td>
  </tr>
</table>
<a name="a34" doxytag="Packet.h::GetBuffOccupation"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT GetBuffOccupation </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>Open</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the amount of bytes present in the packet buffer.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Open</em>&nbsp;</td><td>The NPF instance that closes the file. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a name="a2" doxytag="Packet.h::getTcpBindings"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PKEY_VALUE_PARTIAL_INFORMATION getTcpBindings </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Returns the MACs that bind to TCP/IP.
<p>
<dl compact><dt><b>Returns:</b></dt><dd>Pointer to the registry key containing the list of adapters on which TCP/IP is bound.</dd></dl>
If <a class="el" href="Packet_8c.html#a12">getAdaptersList()</a> fails, NPF tries to obtain the TCP/IP bindings through this function.     </td>
  </tr>
</table>
<a name="a23" doxytag="Packet.h::NPF_BindAdapter"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_BindAdapter </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PNDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>BindContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PNDIS_STRING&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>DeviceName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>SystemSpecific1</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>SystemSpecific2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback for NDIS BindAdapterHandler. Not used by NPF.
<p>
Function called by NDIS when a new adapter is installed on the machine With Plug and Play. 
<p>
Definition at line <a class="el" href="Openclos_8c-source.html#l00577">577</a> of file <a class="el" href="Openclos_8c-source.html">Openclos.c</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a14" doxytag="Packet.h::NPF_BufferedWrite"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> INT NPF_BufferedWrite </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PIRP&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Irp</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>UserBuff</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>UserBuffSize</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>sync</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Writes a buffer of raw packets to the network.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Irp</em>&nbsp;</td><td>Pointer to the IRP containing the user request. </td></tr>
    <tr><td valign=top><em>UserBuff</em>&nbsp;</td><td>Pointer to the buffer containing the packets to send. </td></tr>
    <tr><td valign=top><em>UserBuffSize</em>&nbsp;</td><td>Size of the buffer with the packets. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The amount of bytes actually sent. If the return value is smaller than the Size parameter, an error occurred during the send. The error can be caused by an adapter problem or by an inconsistent/bogus user buffer.</dd></dl>
This function is called by the OS in consequence of a BIOCSENDPACKETSNOSYNC or a BIOCSENDPACKETSSYNC IOCTL. The buffer received as input parameter contains an arbitrary number of packets, each of which preceded by a <a class="el" href="structsf__pkthdr.html">sf_pkthdr</a> structure. <a class="el" href="group__NPF__code.html#a14">NPF_BufferedWrite()</a> scans the buffer and sends every packet via the NdisSend() function. When Sync is set to TRUE, the packets are synchronized with the KeQueryPerformanceCounter() function. This requires a remarkable amount of CPU, but allows to respect the timestamps associated with packets with a precision of some microseconds (depending on the precision of the performance counter of the machine). If Sync is false, the timestamps are ignored and the packets are sent as fat as possible. 
<p>
Definition at line <a class="el" href="Write_8c-source.html#l00136">136</a> of file <a class="el" href="Write_8c-source.html">Write.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet_8h-source.html#l00346">_OPEN_INSTANCE::Bound</a>, <a class="el" href="Packet_8h-source.html#l00213">sf_pkthdr::caplen</a>, <a class="el" href="Packet_8h-source.html#l00365">_OPEN_INSTANCE::MaxFrameSize</a>, <a class="el" href="Write_8c-source.html#l00298">NPF_SendComplete()</a>, <a class="el" href="Packet_8h-source.html#l00310">_OPEN_INSTANCE::PacketPool</a>, <a class="el" href="Packet_8h-source.html#l00251">RESERVED</a>, and <a class="el" href="Packet_8h-source.html#l00212">sf_pkthdr::ts</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>.    </td>
  </tr>
</table>
<a name="a6" doxytag="Packet.h::NPF_Close"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_Close </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>DeviceObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PIRP&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Closes an instance of the driver.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Pointer to the device object utilized by the user. </td></tr>
    <tr><td valign=top><em>Irp</em>&nbsp;</td><td>Pointer to the IRP containing the user request. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
This function is called when a running instance of the driver is closed by the user with a CloseHandle(). It stops the capture/monitoring/dump process, deallocates the memory and the objects associated with the instance and closing the files. The network adapter is then closed with a call to NdisCloseAdapter. 
<p>
Definition at line <a class="el" href="Openclos_8c-source.html#l00380">380</a> of file <a class="el" href="Openclos_8c-source.html">Openclos.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet_8h-source.html#l00346">_OPEN_INSTANCE::Bound</a>, <a class="el" href="jitter_8c-source.html#l00659">BPF_Destroy_JIT_Filter()</a>, <a class="el" href="Packet_8h-source.html#l00324">_OPEN_INSTANCE::bpfprogram</a>, <a class="el" href="Packet_8h-source.html#l00275">__CPU_Private_Data::Buffer</a>, <a class="el" href="Packet_8h-source.html#l00367">_OPEN_INSTANCE::CpuData</a>, <a class="el" href="Packet_8h-source.html#l00352">_OPEN_INSTANCE::DumpEvent</a>, <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, <a class="el" href="Packet_8h-source.html#l00354">_OPEN_INSTANCE::DumpFileName</a>, <a class="el" href="Packet_8h-source.html#l00350">_OPEN_INSTANCE::DumpThreadObject</a>, <a class="el" href="Packet_8h-source.html#l00329">_OPEN_INSTANCE::Filter</a>, <a class="el" href="Packet_8h-source.html#l00344">_OPEN_INSTANCE::IOEvent</a>, <a class="el" href="Packet_8h-source.html#l00362">_OPEN_INSTANCE::mem_ex</a>, <a class="el" href="Packet_8h-source.html#l00336">_OPEN_INSTANCE::mode</a>, <a class="el" href="Packet_8h-source.html#l00179">MODE_DUMP</a>, <a class="el" href="Openclos_8c-source.html#l00492">NPF_CloseAdapterComplete()</a>, <a class="el" href="dump_8c-source.html#l00459">NPF_CloseDumpFile()</a>, <a class="el" href="Packet_8h-source.html#l00311">_OPEN_INSTANCE::OpenCloseIrp</a>, <a class="el" href="Packet_8h-source.html#l00310">_OPEN_INSTANCE::PacketPool</a>, <a class="el" href="Packet_8h-source.html#l00318">_OPEN_INSTANCE::ReadEvent</a>, <a class="el" href="Packet_8h-source.html#l00319">_OPEN_INSTANCE::ReadEventHandle</a>, <a class="el" href="Packet_8h-source.html#l00320">_OPEN_INSTANCE::ReadEventName</a>, and <a class="el" href="Packet_8h-source.html#l00371">_OPEN_INSTANCE::Size</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a7" doxytag="Packet.h::NPF_CloseAdapterComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_CloseAdapterComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Ends the closing of an adapter.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with the current instance. </td></tr>
    <tr><td valign=top><em>Status</em>&nbsp;</td><td>Status of the close operation performed by NDIS.</td></tr>
  </table>
</dl>
Callback function associated with the NdisCloseAdapter() NDIS function. It is invoked by NDIS when the NIC driver has finished a close operation that was previously started by <a class="el" href="group__NPF__code.html#a6">NPF_Close()</a>. 
<p>
Definition at line <a class="el" href="Openclos_8c-source.html#l00492">492</a> of file <a class="el" href="Openclos_8c-source.html">Openclos.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00346">_OPEN_INSTANCE::Bound</a>, <a class="el" href="jitter_8c-source.html#l00659">BPF_Destroy_JIT_Filter()</a>, <a class="el" href="Packet_8h-source.html#l00324">_OPEN_INSTANCE::bpfprogram</a>, <a class="el" href="Packet_8h-source.html#l00275">__CPU_Private_Data::Buffer</a>, <a class="el" href="Packet_8h-source.html#l00367">_OPEN_INSTANCE::CpuData</a>, <a class="el" href="Packet_8h-source.html#l00354">_OPEN_INSTANCE::DumpFileName</a>, <a class="el" href="Packet_8h-source.html#l00329">_OPEN_INSTANCE::Filter</a>, <a class="el" href="Packet_8h-source.html#l00344">_OPEN_INSTANCE::IOEvent</a>, <a class="el" href="Packet_8h-source.html#l00362">_OPEN_INSTANCE::mem_ex</a>, <a class="el" href="Openclos_8c-source.html#l00060">n_Opened_Instances</a>, <a class="el" href="Packet_8h-source.html#l00311">_OPEN_INSTANCE::OpenCloseIrp</a>, <a class="el" href="Packet_8h-source.html#l00310">_OPEN_INSTANCE::PacketPool</a>, <a class="el" href="Packet_8h-source.html#l00320">_OPEN_INSTANCE::ReadEventName</a>, and <a class="el" href="Packet_8h-source.html#l00371">_OPEN_INSTANCE::Size</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>, <a class="el" href="Openclos_8c-source.html#l00380">NPF_Close()</a>, and <a class="el" href="Openclos_8c-source.html#l00591">NPF_UnbindAdapter()</a>.    </td>
  </tr>
</table>
<a name="a33" doxytag="Packet.h::NPF_CloseDumpFile"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_CloseDumpFile </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>Open</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Closes the dump file associated with an instance of the driver.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Open</em>&nbsp;</td><td>The NPF instance that closes the file. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK. </dd></dl>

<p>
Definition at line <a class="el" href="dump_8c-source.html#l00459">459</a> of file <a class="el" href="dump_8c-source.html">dump.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, <a class="el" href="Packet_8h-source.html#l00354">_OPEN_INSTANCE::DumpFileName</a>, <a class="el" href="Packet_8h-source.html#l00349">_OPEN_INSTANCE::DumpFileObject</a>, <a class="el" href="Packet_8h-source.html#l00353">_OPEN_INSTANCE::DumpOffset</a>, <a class="el" href="dump_8c-source.html#l00034">NPF_OpenDumpFile()</a>, and <a class="el" href="dump_8c-source.html#l00301">NPF_SaveCurrentBuffer()</a>.
<p>
Referenced by <a class="el" href="Openclos_8c-source.html#l00380">NPF_Close()</a>, <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>, and <a class="el" href="Openclos_8c-source.html#l00591">NPF_UnbindAdapter()</a>.    </td>
  </tr>
</table>
<a name="a30" doxytag="Packet.h::NPF_DumpThread"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_DumpThread </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>Open</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The dump thread.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Open</em>&nbsp;</td><td>The NPF instance that creates the thread.</td></tr>
  </table>
</dl>
This function moves the content of the NPF kernel buffer to file. It runs in the user context, so at lower priority than the TAP.     </td>
  </tr>
</table>
<a name="a11" doxytag="Packet.h::NPF_IoControl"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_IoControl </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>DeviceObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PIRP&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handles the IOCTL calls.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Pointer to the device object utilized by the user. </td></tr>
    <tr><td valign=top><em>Irp</em>&nbsp;</td><td>Pointer to the IRP containing the user request. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
Once the packet capture driver is opened it can be configured from user-level applications with IOCTL commands using the DeviceIoControl() system call. NPF_IoControl receives and serves all the IOCTL calls directed to NPF. The following commands are recognized:<ul>
<li><a class="el" href="group__NPF__include.html#a17">BIOCSETBUFFERSIZE</a></li><li><a class="el" href="group__NPF__include.html#a18">BIOCSETF</a></li><li><a class="el" href="group__NPF__include.html#a19">BIOCGSTATS</a></li><li><a class="el" href="group__NPF__include.html#a20">BIOCSRTIMEOUT</a></li><li><a class="el" href="group__NPF__include.html#a21">BIOCSMODE</a></li><li><a class="el" href="group__NPF__include.html#a22">BIOCSWRITEREP</a></li><li><a class="el" href="group__NPF__include.html#a23">BIOCSMINTOCOPY</a></li><li><a class="el" href="group__NPF__include.html#a24">BIOCSETOID</a></li><li><a class="el" href="group__NPF__include.html#a25">BIOCQUERYOID</a></li><li><a class="el" href="group__NPF__include.html#a26">BIOCSETDUMPFILENAME</a></li><li><a class="el" href="group__NPF__include.html#a27">BIOCGEVNAME</a></li><li><a class="el" href="group__NPF__include.html#a29">BIOCSENDPACKETSSYNC</a></li><li><a class="el" href="group__NPF__include.html#a28">BIOCSENDPACKETSNOSYNC</a> </li></ul>

<p>
Definition at line <a class="el" href="Packet_8c-source.html#l00549">549</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00276">__CPU_Private_Data::Accepted</a>, <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet_8h-source.html#l00138">BIOCGEVNAME</a>, <a class="el" href="Packet_8h-source.html#l00076">BIOCGSTATS</a>, <a class="el" href="Packet_8h-source.html#l00173">BIOCISDUMPENDED</a>, <a class="el" href="Packet_8h-source.html#l00121">BIOCQUERYOID</a>, <a class="el" href="Packet_8h-source.html#l00147">BIOCSENDPACKETSNOSYNC</a>, <a class="el" href="Packet_8h-source.html#l00157">BIOCSENDPACKETSSYNC</a>, <a class="el" href="Packet_8h-source.html#l00056">BIOCSETBUFFERSIZE</a>, <a class="el" href="Packet_8h-source.html#l00130">BIOCSETDUMPFILENAME</a>, <a class="el" href="Packet_8h-source.html#l00165">BIOCSETDUMPLIMITS</a>, <a class="el" href="Packet_8h-source.html#l00068">BIOCSETF</a>, <a class="el" href="Packet_8h-source.html#l00114">BIOCSETOID</a>, <a class="el" href="Packet_8h-source.html#l00107">BIOCSMINTOCOPY</a>, <a class="el" href="Packet_8h-source.html#l00092">BIOCSMODE</a>, <a class="el" href="Packet_8h-source.html#l00083">BIOCSRTIMEOUT</a>, <a class="el" href="Packet_8h-source.html#l00100">BIOCSWRITEREP</a>, <a class="el" href="jitter_8c-source.html#l00659">BPF_Destroy_JIT_Filter()</a>, <a class="el" href="jitter_8c-source.html#l00608">BPF_jitter()</a>, <a class="el" href="Win32-Extensions_8h-source.html#l00054">BPF_SEPARATION</a>, <a class="el" href="Packet_8h.html#a25">bpf_validate()</a>, <a class="el" href="Packet_8h-source.html#l00324">_OPEN_INSTANCE::bpfprogram</a>, <a class="el" href="Packet_8h-source.html#l00275">__CPU_Private_Data::Buffer</a>, <a class="el" href="Packet_8h-source.html#l00273">__CPU_Private_Data::C</a>, <a class="el" href="Packet_8h-source.html#l00339">_OPEN_INSTANCE::CountersLock</a>, <a class="el" href="Packet_8h-source.html#l00367">_OPEN_INSTANCE::CpuData</a>, <a class="el" href="Packet_8h-source.html#l00284">__CPU_Private_Data::Dropped</a>, <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, <a class="el" href="Packet_8h-source.html#l00354">_OPEN_INSTANCE::DumpFileName</a>, <a class="el" href="Packet_8h-source.html#l00360">_OPEN_INSTANCE::DumpLimitReached</a>, <a class="el" href="Packet_8h-source.html#l00404">EXIT_FAILURE</a>, <a class="el" href="Packet_8h-source.html#l00398">EXIT_SUCCESS</a>, <a class="el" href="Packet_8h-source.html#l00329">_OPEN_INSTANCE::Filter</a>, <a class="el" href="Packet_8h-source.html#l00274">__CPU_Private_Data::Free</a>, <a class="el" href="Packet_8h-source.html#l00182">IMMEDIATE</a>, <a class="el" href="Packet_8h-source.html#l00231">_INTERNAL_REQUEST::Internal</a>, <a class="el" href="Packet32_8h-source.html#l00049">IOCTL_PROTOCOL_RESET</a>, <a class="el" href="Packet_8h-source.html#l00344">_OPEN_INSTANCE::IOEvent</a>, <a class="el" href="Packet_8h-source.html#l00345">_OPEN_INSTANCE::IOStatus</a>, <a class="el" href="Packet_8h-source.html#l00230">_INTERNAL_REQUEST::Irp</a>, <a class="el" href="Packet_8h-source.html#l00355">_OPEN_INSTANCE::MaxDumpBytes</a>, <a class="el" href="Packet_8h-source.html#l00357">_OPEN_INSTANCE::MaxDumpPacks</a>, <a class="el" href="Packet_8h-source.html#l00362">_OPEN_INSTANCE::mem_ex</a>, <a class="el" href="Packet_8h-source.html#l00331">_OPEN_INSTANCE::MinToCopy</a>, <a class="el" href="Packet_8h-source.html#l00336">_OPEN_INSTANCE::mode</a>, <a class="el" href="Packet_8h-source.html#l00176">MODE_CAPT</a>, <a class="el" href="Packet_8h-source.html#l00179">MODE_DUMP</a>, <a class="el" href="Packet_8h-source.html#l00178">MODE_MON</a>, <a class="el" href="Packet_8h-source.html#l00177">MODE_STAT</a>, <a class="el" href="Packet_8h-source.html#l00337">_OPEN_INSTANCE::Nbytes</a>, <a class="el" href="Packet_8c-source.html#l00064">NCpu</a>, <a class="el" href="Packet_8h-source.html#l00338">_OPEN_INSTANCE::Npackets</a>, <a class="el" href="Write_8c-source.html#l00136">NPF_BufferedWrite()</a>, <a class="el" href="dump_8c-source.html#l00459">NPF_CloseDumpFile()</a>, <a class="el" href="dump_8c-source.html#l00034">NPF_OpenDumpFile()</a>, <a class="el" href="Packet_8c-source.html#l01128">NPF_RequestComplete()</a>, <a class="el" href="Openclos_8c-source.html#l00648">NPF_ResetComplete()</a>, <a class="el" href="dump_8c-source.html#l00142">NPF_StartDump()</a>, <a class="el" href="Packet_8h-source.html#l00340">_OPEN_INSTANCE::Nwrites</a>, <a class="el" href="Packet_8h-source.html#l00272">__CPU_Private_Data::P</a>, <a class="el" href="Packet32_8h-source.html#l00230">PPACKET_OID_DATA</a>, <a class="el" href="Packet_8h-source.html#l00288">__CPU_Private_Data::Processing</a>, <a class="el" href="Packet_8h-source.html#l00368">_OPEN_INSTANCE::ReaderSN</a>, <a class="el" href="Packet_8h-source.html#l00320">_OPEN_INSTANCE::ReadEventName</a>, <a class="el" href="Packet_8h-source.html#l00280">__CPU_Private_Data::Received</a>, <a class="el" href="Packet_8h-source.html#l00232">_INTERNAL_REQUEST::Request</a>, <a class="el" href="Packet_8h-source.html#l00314">_OPEN_INSTANCE::RequestList</a>, <a class="el" href="Packet_8h-source.html#l00313">_OPEN_INSTANCE::RequestSpinLock</a>, <a class="el" href="Packet_8h-source.html#l00315">_OPEN_INSTANCE::ResetIrpList</a>, <a class="el" href="Packet_8h-source.html#l00371">_OPEN_INSTANCE::Size</a>, <a class="el" href="Packet_8h-source.html#l00372">_OPEN_INSTANCE::SkipProcessing</a>, <a class="el" href="Packet_8h-source.html#l00333">_OPEN_INSTANCE::TimeOut</a>, <a class="el" href="Packet_8h-source.html#l00363">_OPEN_INSTANCE::tme</a>, and <a class="el" href="Packet_8h-source.html#l00369">_OPEN_INSTANCE::WriterSN</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a4" doxytag="Packet.h::NPF_Open"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_Open </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>DeviceObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PIRP&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Opens a new instance of the driver.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Pointer to the device object utilized by the user. </td></tr>
    <tr><td valign=top><em>Irp</em>&nbsp;</td><td>Pointer to the IRP containing the user request. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
This function is called by the OS when a new instance of the driver is opened, i.e. when a user application performs a CreateFile on a device created by NPF. NPF_Open allocates and initializes variables, objects and buffers needed by the new instance, fills the OPEN_INSTANCE structure associated with it and opens the adapter with a call to NdisOpenAdapter. 
<p>
Definition at line <a class="el" href="Openclos_8c-source.html#l00066">66</a> of file <a class="el" href="Openclos_8c-source.html">Openclos.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet_8h-source.html#l00260">_DEVICE_EXTENSION::AdapterName</a>, <a class="el" href="Packet_8h-source.html#l00346">_OPEN_INSTANCE::Bound</a>, <a class="el" href="Packet_8h-source.html#l00324">_OPEN_INSTANCE::bpfprogram</a>, <a class="el" href="Packet_8h-source.html#l00339">_OPEN_INSTANCE::CountersLock</a>, <a class="el" href="Packet_8h-source.html#l00305">_OPEN_INSTANCE::DeviceExtension</a>, <a class="el" href="Packet_8h-source.html#l00352">_OPEN_INSTANCE::DumpEvent</a>, <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, <a class="el" href="Packet_8h-source.html#l00354">_OPEN_INSTANCE::DumpFileName</a>, <a class="el" href="Packet_8h-source.html#l00360">_OPEN_INSTANCE::DumpLimitReached</a>, <a class="el" href="Packet_8h-source.html#l00344">_OPEN_INSTANCE::IOEvent</a>, <a class="el" href="Packet_8h-source.html#l00229">_INTERNAL_REQUEST::ListElement</a>, <a class="el" href="Packet_8h-source.html#l00364">_OPEN_INSTANCE::MachineLock</a>, <a class="el" href="Packet_8h-source.html#l00039">MAX_REQUESTS</a>, <a class="el" href="Packet_8h-source.html#l00365">_OPEN_INSTANCE::MaxFrameSize</a>, <a class="el" href="Packet_8h-source.html#l00308">_OPEN_INSTANCE::Medium</a>, <a class="el" href="Packet_8h-source.html#l00362">_OPEN_INSTANCE::mem_ex</a>, <a class="el" href="Packet_8h-source.html#l00331">_OPEN_INSTANCE::MinToCopy</a>, <a class="el" href="Packet_8h-source.html#l00336">_OPEN_INSTANCE::mode</a>, <a class="el" href="Packet_8h-source.html#l00176">MODE_CAPT</a>, <a class="el" href="Packet_8h-source.html#l00342">_OPEN_INSTANCE::Multiple_Write_Counter</a>, <a class="el" href="Packet_8h-source.html#l00337">_OPEN_INSTANCE::Nbytes</a>, <a class="el" href="Packet_8h-source.html#l00259">_DEVICE_EXTENSION::NdisProtocolHandle</a>, <a class="el" href="Packet_8h-source.html#l00338">_OPEN_INSTANCE::Npackets</a>, <a class="el" href="Openclos_8c-source.html#l00277">NPF_OpenAdapterComplete()</a>, <a class="el" href="Packet_8h-source.html#l00340">_OPEN_INSTANCE::Nwrites</a>, <a class="el" href="Packet_8h-source.html#l00311">_OPEN_INSTANCE::OpenCloseIrp</a>, <a class="el" href="Openclos_8c-source.html#l00043">PacketItoa()</a>, <a class="el" href="Packet_8h-source.html#l00310">_OPEN_INSTANCE::PacketPool</a>, <a class="el" href="Packet_8h-source.html#l00368">_OPEN_INSTANCE::ReaderSN</a>, <a class="el" href="Packet_8h-source.html#l00318">_OPEN_INSTANCE::ReadEvent</a>, <a class="el" href="Packet_8h-source.html#l00319">_OPEN_INSTANCE::ReadEventHandle</a>, <a class="el" href="Packet_8h-source.html#l00320">_OPEN_INSTANCE::ReadEventName</a>, <a class="el" href="Packet_8h-source.html#l00314">_OPEN_INSTANCE::RequestList</a>, <a class="el" href="Packet_8h-source.html#l00316">_OPEN_INSTANCE::Requests</a>, <a class="el" href="Packet_8h-source.html#l00313">_OPEN_INSTANCE::RequestSpinLock</a>, <a class="el" href="Packet_8h-source.html#l00315">_OPEN_INSTANCE::ResetIrpList</a>, <a class="el" href="Packet_8h-source.html#l00371">_OPEN_INSTANCE::Size</a>, <a class="el" href="Packet_8h-source.html#l00333">_OPEN_INSTANCE::TimeOut</a>, <a class="el" href="Packet_8h-source.html#l00363">_OPEN_INSTANCE::tme</a>, <a class="el" href="Packet_8h-source.html#l00343">_OPEN_INSTANCE::WriteEvent</a>, and <a class="el" href="Packet_8h-source.html#l00369">_OPEN_INSTANCE::WriterSN</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a5" doxytag="Packet.h::NPF_OpenAdapterComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_OpenAdapterComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>OpenErrorStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Ends the opening of an adapter.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with the current instance. </td></tr>
    <tr><td valign=top><em>Status</em>&nbsp;</td><td>Status of the opening operation performed by NDIS. </td></tr>
    <tr><td valign=top><em>OpenErrorStatus</em>&nbsp;</td><td>not used by NPF.</td></tr>
  </table>
</dl>
Callback function associated with the NdisOpenAdapter() NDIS function. It is invoked by NDIS when the NIC driver has finished an open operation that was previously started by <a class="el" href="group__NPF__code.html#a4">NPF_Open()</a>. 
<p>
Definition at line <a class="el" href="Openclos_8c-source.html#l00277">277</a> of file <a class="el" href="Openclos_8c-source.html">Openclos.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet_8h-source.html#l00231">_INTERNAL_REQUEST::Internal</a>, <a class="el" href="Packet_8h-source.html#l00230">_INTERNAL_REQUEST::Irp</a>, <a class="el" href="Packet_8h-source.html#l00365">_OPEN_INSTANCE::MaxFrameSize</a>, <a class="el" href="Packet_8h-source.html#l00362">_OPEN_INSTANCE::mem_ex</a>, <a class="el" href="Openclos_8c-source.html#l00060">n_Opened_Instances</a>, <a class="el" href="Packet_8c-source.html#l01128">NPF_RequestComplete()</a>, <a class="el" href="Packet_8h-source.html#l00311">_OPEN_INSTANCE::OpenCloseIrp</a>, <a class="el" href="Packet_8h-source.html#l00310">_OPEN_INSTANCE::PacketPool</a>, <a class="el" href="Packet_8h-source.html#l00319">_OPEN_INSTANCE::ReadEventHandle</a>, <a class="el" href="Packet_8h-source.html#l00320">_OPEN_INSTANCE::ReadEventName</a>, <a class="el" href="Packet_8h-source.html#l00232">_INTERNAL_REQUEST::Request</a>, <a class="el" href="Packet_8h-source.html#l00314">_OPEN_INSTANCE::RequestList</a>, and <a class="el" href="Packet_8h-source.html#l00313">_OPEN_INSTANCE::RequestSpinLock</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>, and <a class="el" href="Openclos_8c-source.html#l00066">NPF_Open()</a>.    </td>
  </tr>
</table>
<a name="a28" doxytag="Packet.h::NPF_OpenDumpFile"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_OpenDumpFile </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a>&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Open</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>fileName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>append</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Creates the file that will receive the packets when the driver is in dump mode.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Open</em>&nbsp;</td><td>The NPF instance that opens the file. </td></tr>
    <tr><td valign=top><em>fileName</em>&nbsp;</td><td>Pointer to a UNICODE string containing the name of the file. </td></tr>
    <tr><td valign=top><em>append</em>&nbsp;</td><td>Boolean value that specifies if the data must be appended to the file. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK. </dd></dl>

<p>
Definition at line <a class="el" href="dump_8c-source.html#l00034">34</a> of file <a class="el" href="dump_8c-source.html">dump.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, and <a class="el" href="Packet_8h-source.html#l00349">_OPEN_INSTANCE::DumpFileObject</a>.
<p>
Referenced by <a class="el" href="dump_8c-source.html#l00459">NPF_CloseDumpFile()</a>, and <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>.    </td>
  </tr>
</table>
<a name="a22" doxytag="Packet.h::NPF_QueryRegistryRoutine"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_QueryRegistryRoutine </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PWSTR&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ValueName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ValueType</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ValueData</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ValueLength</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Context</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>EntryContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Function used by <a class="el" href="group__NPF__code.html#a21">NPF_ReadRegistry()</a> to quesry the registry keys associated woth NPF if the driver is manually installed via the control panel.
<p>
Normally not used in recent versions of NPF. 
<p>
Definition at line <a class="el" href="Packet_8c-source.html#l01343">1343</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l01246">NPF_ReadRegistry()</a>.    </td>
  </tr>
</table>
<a name="a20" doxytag="Packet.h::NPF_Read"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_Read </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>DeviceObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PIRP&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Function that serves the user's reads.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Pointer to the device used by the user. </td></tr>
    <tr><td valign=top><em>Irp</em>&nbsp;</td><td>Pointer to the IRP containing the user request. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
This function is called by the OS in consequence of user ReadFile() call. It moves the data present in the kernel buffer to the user buffer associated with Irp. First of all, NPF_Read checks the amount of data in kernel buffer associated with current NPF instance.<ul>
<li>If the instance is in capture mode and the buffer contains more than <a class="el" href="struct__OPEN__INSTANCE.html#m15">OPEN_INSTANCE::MinToCopy</a> bytes, NPF_Read moves the data in the user buffer and returns immediatly. In this way, the read performed by the user is not blocking.</li><li>If the buffer contains less than MinToCopy bytes, the application's request isn't satisfied immediately, but it's blocked until at least MinToCopy bytes arrive from the net or the timeout on this read expires. The timeout is kept in the <a class="el" href="struct__OPEN__INSTANCE.html#m16">OPEN_INSTANCE::TimeOut</a> field.</li><li>If the instance is in statistical mode or in dump mode, the application's request is blocked until the timeout kept in <a class="el" href="struct__OPEN__INSTANCE.html#m16">OPEN_INSTANCE::TimeOut</a> expires. </li></ul>

<p>
Definition at line <a class="el" href="Read_8c-source.html#l00037">37</a> of file <a class="el" href="Read_8c-source.html">Read.c</a>.
<p>
References <a class="el" href="Packet32_8h-source.html#l00145">bpf_hdr::bh_caplen</a>, <a class="el" href="Packet32_8h-source.html#l00148">bpf_hdr::bh_datalen</a>, <a class="el" href="Packet32_8h-source.html#l00149">bpf_hdr::bh_hdrlen</a>, <a class="el" href="Packet32_8h-source.html#l00143">bpf_hdr::bh_tstamp</a>, <a class="el" href="Packet_8h-source.html#l00346">_OPEN_INSTANCE::Bound</a>, <a class="el" href="Packet_8h-source.html#l00339">_OPEN_INSTANCE::CountersLock</a>, <a class="el" href="Packet_8h-source.html#l00367">_OPEN_INSTANCE::CpuData</a>, <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, <a class="el" href="Packet_8h-source.html#l00353">_OPEN_INSTANCE::DumpOffset</a>, <a class="el" href="Packet_8h-source.html#l00404">EXIT_FAILURE</a>, <a class="el" href="Packet_8h-source.html#l00398">EXIT_SUCCESS</a>, <a class="el" href="Packet_8h-source.html#l00274">__CPU_Private_Data::Free</a>, <a class="el" href="Packet_8h-source.html#l00389">PacketHeader::header</a>, <a class="el" href="Packet_8h-source.html#l00182">IMMEDIATE</a>, <a class="el" href="Packet_8h-source.html#l00364">_OPEN_INSTANCE::MachineLock</a>, <a class="el" href="Packet_8h-source.html#l00331">_OPEN_INSTANCE::MinToCopy</a>, <a class="el" href="Packet_8h-source.html#l00336">_OPEN_INSTANCE::mode</a>, <a class="el" href="Packet_8h-source.html#l00179">MODE_DUMP</a>, <a class="el" href="Packet_8h-source.html#l00178">MODE_MON</a>, <a class="el" href="Packet_8h-source.html#l00177">MODE_STAT</a>, <a class="el" href="Packet_8h-source.html#l00337">_OPEN_INSTANCE::Nbytes</a>, <a class="el" href="Packet_8c-source.html#l00064">NCpu</a>, <a class="el" href="Packet_8h-source.html#l00338">_OPEN_INSTANCE::Npackets</a>, <a class="el" href="Packet32_8h-source.html#l00080">Packet_WORDALIGN</a>, <a class="el" href="Packet_8h-source.html#l00368">_OPEN_INSTANCE::ReaderSN</a>, <a class="el" href="Packet_8h-source.html#l00318">_OPEN_INSTANCE::ReadEvent</a>, <a class="el" href="Packet_8h-source.html#l00371">_OPEN_INSTANCE::Size</a>, <a class="el" href="Packet_8h-source.html#l00388">PacketHeader::SN</a>, <a class="el" href="Packet_8h-source.html#l00333">_OPEN_INSTANCE::TimeOut</a>, and <a class="el" href="Packet_8h-source.html#l00363">_OPEN_INSTANCE::tme</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a21" doxytag="Packet.h::NPF_ReadRegistry"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_ReadRegistry </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PWSTR *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>MacDriverName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PWSTR *&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>PacketDriverName</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>RegistryPath</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Reads the registry keys associated woth NPF if the driver is manually installed via the control panel.
<p>
Normally not used in recent versions of NPF. 
<p>
Definition at line <a class="el" href="Packet_8c-source.html#l01246">1246</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
References <a class="el" href="Packet_8c-source.html#l01343">NPF_QueryRegistryRoutine()</a>.    </td>
  </tr>
</table>
<a name="a10" doxytag="Packet.h::NPF_ReceiveComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_ReceiveComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>ProtocolBindingContext</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback function that signals the end of a packet reception.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with the current instance.</td></tr>
  </table>
</dl>
does nothing in NPF 
<p>
Definition at line <a class="el" href="Read_8c-source.html#l00876">876</a> of file <a class="el" href="Read_8c-source.html">Read.c</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a12" doxytag="Packet.h::NPF_RequestComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_RequestComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PNDIS_REQUEST&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>pRequest</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Ends an OID request.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with the current instance. </td></tr>
    <tr><td valign=top><em>pRequest</em>&nbsp;</td><td>Pointer to the completed OID request. </td></tr>
    <tr><td valign=top><em>Status</em>&nbsp;</td><td>Status of the operation.</td></tr>
  </table>
</dl>
Callback function associated with the NdisRequest() NDIS function. It is invoked by NDIS when the NIC driver has finished an OID request operation that was previously started by <a class="el" href="group__NPF__code.html#a11">NPF_IoControl()</a>. 
<p>
Definition at line <a class="el" href="Packet_8c-source.html#l01128">1128</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00121">BIOCQUERYOID</a>, <a class="el" href="Packet_8h-source.html#l00114">BIOCSETOID</a>, <a class="el" href="Packet_8h-source.html#l00231">_INTERNAL_REQUEST::Internal</a>, <a class="el" href="Packet_8h-source.html#l00344">_OPEN_INSTANCE::IOEvent</a>, <a class="el" href="Packet_8h-source.html#l00345">_OPEN_INSTANCE::IOStatus</a>, <a class="el" href="Packet_8h-source.html#l00230">_INTERNAL_REQUEST::Irp</a>, <a class="el" href="Packet_8h-source.html#l00229">_INTERNAL_REQUEST::ListElement</a>, <a class="el" href="Packet_8h-source.html#l00365">_OPEN_INSTANCE::MaxFrameSize</a>, <a class="el" href="Packet32_8h-source.html#l00230">PPACKET_OID_DATA</a>, <a class="el" href="Packet_8h-source.html#l00232">_INTERNAL_REQUEST::Request</a>, <a class="el" href="Packet_8h-source.html#l00314">_OPEN_INSTANCE::RequestList</a>, and <a class="el" href="Packet_8h-source.html#l00313">_OPEN_INSTANCE::RequestSpinLock</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>, <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>, and <a class="el" href="Openclos_8c-source.html#l00277">NPF_OpenAdapterComplete()</a>.    </td>
  </tr>
</table>
<a name="a16" doxytag="Packet.h::NPF_ResetComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_ResetComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Ends a reset of the adapter.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with the current instance. </td></tr>
    <tr><td valign=top><em>Status</em>&nbsp;</td><td>Status of the operation.</td></tr>
  </table>
</dl>
Callback function associated with the NdisReset() NDIS function. It is invoked by NDIS when the NIC driver has finished an OID request operation that was previously started by <a class="el" href="group__NPF__code.html#a11">NPF_IoControl()</a>, in an IOCTL_PROTOCOL_RESET command. 
<p>
Definition at line <a class="el" href="Openclos_8c-source.html#l00648">648</a> of file <a class="el" href="Openclos_8c-source.html">Openclos.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00313">_OPEN_INSTANCE::RequestSpinLock</a>, and <a class="el" href="Packet_8h-source.html#l00315">_OPEN_INSTANCE::ResetIrpList</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>, and <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>.    </td>
  </tr>
</table>
<a name="a31" doxytag="Packet.h::NPF_SaveCurrentBuffer"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_SaveCurrentBuffer </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>Open</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Saves the content of the packet buffer to the file associated with current instance.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Open</em>&nbsp;</td><td>The NPF instance that creates the thread.</td></tr>
  </table>
</dl>
Used by <a class="el" href="group__NPF__code.html#a30">NPF_DumpThread()</a> and <a class="el" href="group__NPF__code.html#a33">NPF_CloseDumpFile()</a>. 
<p>
Definition at line <a class="el" href="dump_8c-source.html#l00301">301</a> of file <a class="el" href="dump_8c-source.html">dump.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00349">_OPEN_INSTANCE::DumpFileObject</a>, <a class="el" href="Packet_8h-source.html#l00360">_OPEN_INSTANCE::DumpLimitReached</a>, <a class="el" href="Packet_8h-source.html#l00353">_OPEN_INSTANCE::DumpOffset</a>, <a class="el" href="Packet_8h-source.html#l00355">_OPEN_INSTANCE::MaxDumpBytes</a>, <a class="el" href="dump_8c-source.html#l00520">NPF_WriteDumpFile()</a>, and <a class="el" href="Packet_8h-source.html#l00318">_OPEN_INSTANCE::ReadEvent</a>.
<p>
Referenced by <a class="el" href="dump_8c-source.html#l00459">NPF_CloseDumpFile()</a>, and <a class="el" href="dump_8c-source.html#l00263">NPF_DumpThread()</a>.    </td>
  </tr>
</table>
<a name="a15" doxytag="Packet.h::NPF_SendComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_SendComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PNDIS_PACKET&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>pPacket</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Ends a send operation.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with the current instance. </td></tr>
    <tr><td valign=top><em>pRequest</em>&nbsp;</td><td>Pointer to the NDIS PACKET structure used by <a class="el" href="group__NPF__code.html#a13">NPF_Write()</a> to send the packet. </td></tr>
    <tr><td valign=top><em>Status</em>&nbsp;</td><td>Status of the operation.</td></tr>
  </table>
</dl>
Callback function associated with the NdisSend() NDIS function. It is invoked by NDIS when the NIC driver has finished an OID request operation that was previously started by <a class="el" href="group__NPF__code.html#a13">NPF_Write()</a>. 
<p>
Definition at line <a class="el" href="Write_8c-source.html#l00298">298</a> of file <a class="el" href="Write_8c-source.html">Write.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00342">_OPEN_INSTANCE::Multiple_Write_Counter</a>, <a class="el" href="Packet_8h-source.html#l00340">_OPEN_INSTANCE::Nwrites</a>, <a class="el" href="Packet_8h-source.html#l00251">RESERVED</a>, and <a class="el" href="Packet_8h-source.html#l00343">_OPEN_INSTANCE::WriteEvent</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>, <a class="el" href="Write_8c-source.html#l00136">NPF_BufferedWrite()</a>, and <a class="el" href="Write_8c-source.html#l00034">NPF_Write()</a>.    </td>
  </tr>
</table>
<a name="a29" doxytag="Packet.h::NPF_StartDump"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_StartDump </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="struct__OPEN__INSTANCE.html">POPEN_INSTANCE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>Open</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Starts dump to file.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Open</em>&nbsp;</td><td>The NPF instance that opens the file. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
This function performs two operations. First, it writes the libpcap header at the beginning of the file. Second, it starts the thread that asynchronously dumps the network data to the file. 
<p>
Definition at line <a class="el" href="dump_8c-source.html#l00142">142</a> of file <a class="el" href="dump_8c-source.html">dump.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, <a class="el" href="Packet_8h-source.html#l00349">_OPEN_INSTANCE::DumpFileObject</a>, <a class="el" href="Packet_8h-source.html#l00353">_OPEN_INSTANCE::DumpOffset</a>, <a class="el" href="Packet_8h-source.html#l00351">_OPEN_INSTANCE::DumpThreadHandle</a>, <a class="el" href="Packet_8h-source.html#l00350">_OPEN_INSTANCE::DumpThreadObject</a>, <a class="el" href="Packet_8h-source.html#l00204">packet_file_header::linktype</a>, <a class="el" href="Packet_8h-source.html#l00198">packet_file_header::magic</a>, <a class="el" href="Packet_8h-source.html#l00308">_OPEN_INSTANCE::Medium</a>, <a class="el" href="Packet_8h-source.html#l00188">PCAP_VERSION_MAJOR</a>, <a class="el" href="Packet_8h-source.html#l00189">PCAP_VERSION_MINOR</a>, <a class="el" href="Packet_8h-source.html#l00202">packet_file_header::sigfigs</a>, <a class="el" href="Packet_8h-source.html#l00203">packet_file_header::snaplen</a>, <a class="el" href="Packet_8h-source.html#l00187">TCPDUMP_MAGIC</a>, <a class="el" href="Packet_8h-source.html#l00201">packet_file_header::thiszone</a>, <a class="el" href="Packet_8h-source.html#l00199">packet_file_header::version_major</a>, and <a class="el" href="Packet_8h-source.html#l00200">packet_file_header::version_minor</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00549">NPF_IoControl()</a>.    </td>
  </tr>
</table>
<a name="a17" doxytag="Packet.h::NPF_Status"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_Status </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>StatusBuffer</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>StatusBufferSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback for NDIS StatusHandler. Not used by NPF.
<p>

<p>
Definition at line <a class="el" href="Packet_8c-source.html#l01213">1213</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a18" doxytag="Packet.h::NPF_StatusComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_StatusComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>ProtocolBindingContext</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback for NDIS StatusCompleteHandler. Not used by NPF.
<p>

<p>
Definition at line <a class="el" href="Packet_8c-source.html#l01231">1231</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a8" doxytag="Packet.h::NPF_tap"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NDIS_STATUS NPF_tap </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>MacReceiveContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>HeaderBuffer</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>HeaderBufferSize</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>LookAheadBuffer</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>LookaheadBufferSize</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>PacketSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback invoked by NDIS when a packet arrives from the network.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Points to a OPEN_INSTANCE structure that identifies the NPF instance to which the packets are destined. </td></tr>
    <tr><td valign=top><em>MacReceiveContext</em>&nbsp;</td><td>Handle that identifies the underlying NIC driver that generated the request. This value must be used when the packet is transferred from the NIC driver with NdisTransferData(). </td></tr>
    <tr><td valign=top><em>HeaderBuffer</em>&nbsp;</td><td>Pointer to the buffer in the NIC driver memory that contains the header of the packet. </td></tr>
    <tr><td valign=top><em>HeaderBufferSize</em>&nbsp;</td><td>Size in bytes of the header. </td></tr>
    <tr><td valign=top><em>LookAheadBuffer</em>&nbsp;</td><td>Pointer to the buffer in the NIC driver's memory that contains the incoming packet's data <b>available to NPF</b>. This value does not necessarily coincide with the actual size of the packet, since only a portion can be available at this time. The remaining portion can be obtained with the NdisTransferData() NDIS function. </td></tr>
    <tr><td valign=top><em>LookaheadBufferSize</em>&nbsp;</td><td>Size in bytes of the lookahead buffer. </td></tr>
    <tr><td valign=top><em>PacketSize</em>&nbsp;</td><td>Total size of the incoming packet, excluded the header. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
<a class="el" href="group__NPF__code.html#a8">NPF_tap()</a> is called by the underlying NIC for every incoming packet. It is the most important and one of the most complex functions of NPF: it executes the filter, runs the statistical engine (if the instance is in statistical mode), gathers the timestamp, moves the packet in the buffer. <a class="el" href="group__NPF__code.html#a8">NPF_tap()</a> is the only function, along with the filtering ones, that is executed for every incoming packet, therefore it is carefully optimized. 
<p>
Definition at line <a class="el" href="Read_8c-source.html#l00297">297</a> of file <a class="el" href="Read_8c-source.html">Read.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00276">__CPU_Private_Data::Accepted</a>, <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet32_8h-source.html#l00145">bpf_hdr::bh_caplen</a>, <a class="el" href="Packet32_8h-source.html#l00148">bpf_hdr::bh_datalen</a>, <a class="el" href="Packet32_8h-source.html#l00149">bpf_hdr::bh_hdrlen</a>, <a class="el" href="Packet32_8h-source.html#l00143">bpf_hdr::bh_tstamp</a>, <a class="el" href="Packet_8h.html#a26">bpf_filter()</a>, <a class="el" href="Packet_8h.html#a27">bpf_filter_with_2_buffers()</a>, <a class="el" href="Packet_8h-source.html#l00324">_OPEN_INSTANCE::bpfprogram</a>, <a class="el" href="Packet_8h-source.html#l00339">_OPEN_INSTANCE::CountersLock</a>, <a class="el" href="Packet_8h-source.html#l00367">_OPEN_INSTANCE::CpuData</a>, <a class="el" href="Packet_8h-source.html#l00284">__CPU_Private_Data::Dropped</a>, <a class="el" href="Packet_8h-source.html#l00352">_OPEN_INSTANCE::DumpEvent</a>, <a class="el" href="Packet_8h-source.html#l00360">_OPEN_INSTANCE::DumpLimitReached</a>, <a class="el" href="Packet_8h-source.html#l00329">_OPEN_INSTANCE::Filter</a>, <a class="el" href="jitter_8h-source.html#l00084">JIT_BPF_Filter::Function</a>, <a class="el" href="Packet_8h-source.html#l00389">PacketHeader::header</a>, <a class="el" href="Packet_8h-source.html#l00364">_OPEN_INSTANCE::MachineLock</a>, <a class="el" href="Packet_8h-source.html#l00357">_OPEN_INSTANCE::MaxDumpPacks</a>, <a class="el" href="Packet_8h-source.html#l00362">_OPEN_INSTANCE::mem_ex</a>, <a class="el" href="Packet_8h-source.html#l00331">_OPEN_INSTANCE::MinToCopy</a>, <a class="el" href="Packet_8h-source.html#l00336">_OPEN_INSTANCE::mode</a>, <a class="el" href="Packet_8h-source.html#l00179">MODE_DUMP</a>, <a class="el" href="Packet_8h-source.html#l00178">MODE_MON</a>, <a class="el" href="Packet_8h-source.html#l00177">MODE_STAT</a>, <a class="el" href="Packet_8h-source.html#l00337">_OPEN_INSTANCE::Nbytes</a>, <a class="el" href="Packet_8c-source.html#l00064">NCpu</a>, <a class="el" href="Packet_8h-source.html#l00338">_OPEN_INSTANCE::Npackets</a>, <a class="el" href="Packet_8h-source.html#l00310">_OPEN_INSTANCE::PacketPool</a>, <a class="el" href="Packet_8h-source.html#l00288">__CPU_Private_Data::Processing</a>, <a class="el" href="Packet_8h-source.html#l00318">_OPEN_INSTANCE::ReadEvent</a>, <a class="el" href="Packet_8h-source.html#l00280">__CPU_Private_Data::Received</a>, <a class="el" href="Packet_8h-source.html#l00251">RESERVED</a>, <a class="el" href="Packet_8h-source.html#l00371">_OPEN_INSTANCE::Size</a>, <a class="el" href="Packet_8h-source.html#l00372">_OPEN_INSTANCE::SkipProcessing</a>, <a class="el" href="Packet_8h-source.html#l00388">PacketHeader::SN</a>, <a class="el" href="Packet_8h-source.html#l00363">_OPEN_INSTANCE::tme</a>, and <a class="el" href="Packet_8h-source.html#l00369">_OPEN_INSTANCE::WriterSN</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a9" doxytag="Packet.h::NPF_TransferDataComplete"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_TransferDataComplete </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PNDIS_PACKET&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Packet</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>BytesTransferred</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Ends the transfer of a packet.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with the current instance. </td></tr>
    <tr><td valign=top><em>Packet</em>&nbsp;</td><td>Pointer to the NDIS_PACKET structure that received the packet data. </td></tr>
    <tr><td valign=top><em>Status</em>&nbsp;</td><td>Status of the transfer operation. </td></tr>
    <tr><td valign=top><em>BytesTransferred</em>&nbsp;</td><td>Amount of bytes transferred.</td></tr>
  </table>
</dl>
Callback function associated with the NdisTransferData() NDIS function. It is invoked by NDIS when the NIC driver has finished the transfer of a packet from the NIC driver memory to the NPF circular buffer. 
<p>
Definition at line <a class="el" href="Read_8c-source.html#l00807">807</a> of file <a class="el" href="Read_8c-source.html">Read.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00276">__CPU_Private_Data::Accepted</a>, <a class="el" href="Packet32_8h-source.html#l00145">bpf_hdr::bh_caplen</a>, <a class="el" href="Packet32_8h-source.html#l00143">bpf_hdr::bh_tstamp</a>, <a class="el" href="Packet_8h-source.html#l00367">_OPEN_INSTANCE::CpuData</a>, <a class="el" href="Packet_8h-source.html#l00352">_OPEN_INSTANCE::DumpEvent</a>, <a class="el" href="Packet_8h-source.html#l00389">PacketHeader::header</a>, <a class="el" href="Packet_8h-source.html#l00331">_OPEN_INSTANCE::MinToCopy</a>, <a class="el" href="Packet_8h-source.html#l00336">_OPEN_INSTANCE::mode</a>, <a class="el" href="Packet_8h-source.html#l00179">MODE_DUMP</a>, <a class="el" href="Packet_8h-source.html#l00318">_OPEN_INSTANCE::ReadEvent</a>, <a class="el" href="Packet_8h-source.html#l00251">RESERVED</a>, <a class="el" href="Packet_8h-source.html#l00371">_OPEN_INSTANCE::Size</a>, <a class="el" href="Packet_8h-source.html#l00388">PacketHeader::SN</a>, <a class="el" href="Packet_8h-source.html#l00289">__CPU_Private_Data::TransferMdl1</a>, <a class="el" href="Packet_8h-source.html#l00290">__CPU_Private_Data::TransferMdl2</a>, and <a class="el" href="Packet_8h-source.html#l00369">_OPEN_INSTANCE::WriterSN</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a24" doxytag="Packet.h::NPF_UnbindAdapter"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_UnbindAdapter </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PNDIS_STATUS&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Status</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>ProtocolBindingContext</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN NDIS_HANDLE&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>UnbindContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Callback for NDIS UnbindAdapterHandler.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>Status</em>&nbsp;</td><td>out variable filled by NPF_UnbindAdapter with the status of the unbind operation. </td></tr>
    <tr><td valign=top><em>ProtocolBindingContext</em>&nbsp;</td><td>Context of the function. Contains a pointer to the OPEN_INSTANCE structure associated with current instance. </td></tr>
    <tr><td valign=top><em>UnbindContext</em>&nbsp;</td><td>Specifies a handle, supplied by NDIS, that NPF can use to complete the opration.</td></tr>
  </table>
</dl>
Function called by NDIS when a new adapter is removed from the machine without shutting it down. NPF_UnbindAdapter closes the adapter calling NdisCloseAdapter() and frees the memory and the structures associated with it. It also releases the waiting user-level app and closes the dump thread if the instance is in dump mode. 
<p>
Definition at line <a class="el" href="Openclos_8c-source.html#l00591">591</a> of file <a class="el" href="Openclos_8c-source.html">Openclos.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet_8h-source.html#l00346">_OPEN_INSTANCE::Bound</a>, <a class="el" href="Packet_8h-source.html#l00352">_OPEN_INSTANCE::DumpEvent</a>, <a class="el" href="Packet_8h-source.html#l00348">_OPEN_INSTANCE::DumpFileHandle</a>, <a class="el" href="Packet_8h-source.html#l00344">_OPEN_INSTANCE::IOEvent</a>, <a class="el" href="Packet_8h-source.html#l00336">_OPEN_INSTANCE::mode</a>, <a class="el" href="Packet_8h-source.html#l00179">MODE_DUMP</a>, <a class="el" href="Openclos_8c-source.html#l00492">NPF_CloseAdapterComplete()</a>, <a class="el" href="dump_8c-source.html#l00459">NPF_CloseDumpFile()</a>, <a class="el" href="Packet_8h-source.html#l00318">_OPEN_INSTANCE::ReadEvent</a>, and <a class="el" href="Packet_8h-source.html#l00319">_OPEN_INSTANCE::ReadEventHandle</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a19" doxytag="Packet.h::NPF_Unload"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_Unload </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDRIVER_OBJECT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>DriverObject</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Function called by the OS when NPF is unloaded.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DriverObject</em>&nbsp;</td><td>The driver object of NPF created by the system.</td></tr>
  </table>
</dl>
This is the last function executed when the driver is unloaded from the system. It frees global resources, delete the devices and deregisters the protocol. The driver can be unloaded by the user stopping the NPF service (from control panel or with a console 'net stop npf'). 
<p>
Definition at line <a class="el" href="Packet_8c-source.html#l00495">495</a> of file <a class="el" href="Packet_8c-source.html">Packet.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00260">_DEVICE_EXTENSION::AdapterName</a>, <a class="el" href="Packet_8h-source.html#l00261">_DEVICE_EXTENSION::ExportString</a>, and <a class="el" href="Packet_8h-source.html#l00259">_DEVICE_EXTENSION::NdisProtocolHandle</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a13" doxytag="Packet.h::NPF_Write"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NPF_Write </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDEVICE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>DeviceObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>IN PIRP&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Irp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Writes a raw packet to the network.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>DeviceObject</em>&nbsp;</td><td>Pointer to the device object on which the user wrote the packet. </td></tr>
    <tr><td valign=top><em>Irp</em>&nbsp;</td><td>Pointer to the IRP containing the user request. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
This function is called by the OS in consequence of user WriteFile() call, with the data of the packet that must be sent on the net. The data is contained in the buffer associated with Irp, NPF_Write takes it and delivers it to the NIC driver via the NdisSend() function. The Nwrites field of the OPEN_INSTANCE structure associated with Irp indicates the number of copies of the packet that will be sent: more than one copy of the packet can be sent for performance reasons. 
<p>
Definition at line <a class="el" href="Write_8c-source.html#l00034">34</a> of file <a class="el" href="Write_8c-source.html">Write.c</a>.
<p>
References <a class="el" href="Packet_8h-source.html#l00307">_OPEN_INSTANCE::AdapterHandle</a>, <a class="el" href="Packet_8h-source.html#l00346">_OPEN_INSTANCE::Bound</a>, <a class="el" href="Packet_8h-source.html#l00404">EXIT_FAILURE</a>, <a class="el" href="Packet_8h-source.html#l00365">_OPEN_INSTANCE::MaxFrameSize</a>, <a class="el" href="Packet_8h-source.html#l00342">_OPEN_INSTANCE::Multiple_Write_Counter</a>, <a class="el" href="Write_8c-source.html#l00298">NPF_SendComplete()</a>, <a class="el" href="Packet_8h-source.html#l00340">_OPEN_INSTANCE::Nwrites</a>, <a class="el" href="Packet_8h-source.html#l00310">_OPEN_INSTANCE::PacketPool</a>, <a class="el" href="Packet_8h-source.html#l00251">RESERVED</a>, and <a class="el" href="Packet_8h-source.html#l00343">_OPEN_INSTANCE::WriteEvent</a>.
<p>
Referenced by <a class="el" href="Packet_8c-source.html#l00070">DriverEntry()</a>.    </td>
  </tr>
</table>
<a name="a32" doxytag="Packet.h::NPF_WriteDumpFile"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID NPF_WriteDumpFile </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PFILE_OBJECT&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>FileObject</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Offset</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Length</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PMDL&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>Mdl</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap>&nbsp; <em>IoStatusBlock</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Writes a block of packets on the dump file.
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>FileObject</em>&nbsp;</td><td>The file object that will receive the packets. </td></tr>
    <tr><td valign=top><em>Offset</em>&nbsp;</td><td>The offset in the file where the packets will be put. </td></tr>
    <tr><td valign=top><em>Length</em>&nbsp;</td><td>The amount of bytes to write. </td></tr>
    <tr><td valign=top><em>Mdl</em>&nbsp;</td><td>MDL mapping the memory buffer that will be written to disk. </td></tr>
    <tr><td valign=top><em>IoStatusBlock</em>&nbsp;</td><td>Used by the function to return the status of the operation. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The status of the operation. See ntstatus.h in the DDK.</dd></dl>
NPF_WriteDumpFile addresses directly the file system, creating a custom IRP and using it to send a portion of the NPF circular buffer to disk. This function is used by <a class="el" href="group__NPF__code.html#a30">NPF_DumpThread()</a>. 
<p>
Definition at line <a class="el" href="dump_8c-source.html#l00520">520</a> of file <a class="el" href="dump_8c-source.html">dump.c</a>.
<p>
Referenced by <a class="el" href="dump_8c-source.html#l00301">NPF_SaveCurrentBuffer()</a>.    </td>
  </tr>
</table>

<hr>
<p align="right"><img border="0" src="winpcap_small.gif" align="absbottom" width="91" height="27">
documentation. Copyright (c) 2002-2003 Politecnico di Torino. All rights reserved.</p>
