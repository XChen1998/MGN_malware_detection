# TagCheck Static Service

NOTE: This service does not require you to buy any licence and is preinstalled and working after a default installation.

This is a post-service that compares all TAGs generated by an Assemblyline scan to a signature set, and can perform an
action based on a signature match: i.e. generate more tags, elevate scores, further analyze a file (via callback 
functions), etc.

### Signatures

Signatures are stored in Riak. You can retrieve the signature set as follows:

        ds = forge.get_datastore()
        ds.get_blob('tagcheck_signatures')

Example signature structure:

    "MALICIOUS_FILENAME_EXE":
    {
        "status":"DEPLOYED",
        "score":"VHIGH",
        "threat_actor":"CRIMEWARE",
        "implant_name":"UNNAMED_IMPLANT",
        "comment":"Unique filename found in crimeware sample",
        "value":['FILE_NAME:.*\\malware\.exe$'],
        "callback":None,
        "classification":None,
    }

Field descriptions:

    * signature name:   Unique key that will be displayed in the result set when a match is found.
    * classification:   Optional field. Can be used to restrict access to results based on organizational needs.
    * status:           Signature status in AL (TESTING/STAGING/DEPLOYED/DISABLED). --currently not used.
    * score:            Provide # (can be negative) or known ASL keywords:
                        `INFO` (0), `LOW` (10), `MED` (50), `HIGH` (100), `VHIGH` (500), `SURE` (1000), `NULL` (0)
                        `OK` (-100), NOt (-1000)
    * threat_actor:     Threat actor/general malware type (i.e. CRIMEWARE). Will generate new tag to the results.
    * implant_name:     Implant name/general malware type (i.e. L0cky).  Will generate new tag to the results.
    * comment:          Additional information for the signature.
    * value:            Tag(s) to be matched.
                        Format single tag:      TAG_TYPE:TAG_VALUE
                        Format multiple tag:    TAG_TYPE:TAG_VALUE;TAG_TYPE:TAG_VALUE
                        ***NOTE:REGEX values are used for both TAG_TYPE and TAG_VALUE!***
                        Example:
                        .*MUTEX.*:(?i)BMUTEX\\! --matches tag type containing string 'MUTEX' & value 'BMUTEX\!' (nocase)
    * callback:         A function to call when the signature hits. These are stored in callbacks.py. Please refer 
                        to 'add_tag' callback in callbacks.py to see an example of how to write callback, and how to 
                        add one to your TagCheck signature.


Signature lists in CSV format can be moved in to Riak with tsig.py. This simple script will dump the current 
'tagcheck_signatures' blob in Riak and save it to disk in the directory the script was run. The script will then load 
the new signature set. The expected field order for the input CSV is the same as the field descriptions section. 
__*Note: This script does not APPEND signatures to RIAK, it OVERWRITES them.*__


Command example:

    $ python /opt/al/pkg/al_services/alsvc_tagcheck/tsig.py tag_sig_file.csv



A simple set of signatures is included with the default service. The file name is 'sample_sigset.csv' and is loaded by 
the service's installer script.