#include <stdio.h>
#include <Windows.h>

int IsInsideVPC()
{
  bool rc = false;
  char vm[] = "VMXh";
  char port[] = "VX";

  __try
  {
    __asm{
      push ebx
      mov ebx, 0
      mov eax, 1

      __emit 0Fh
      __emit 3Fh
      __emit 07h
      __emit 0Bh

      test ebx, ebx
      setz [rc]
      pop ebx
    }
  }
  __except(EXCEPTION_EXECUTE_HANDLER)
  {
  }

  return rc;
}

int main() {
    if(IsInsideVPC()){
      printf("virtual pc");
    }else{
      printf("native pc");
    }
    return 0 ;
}
