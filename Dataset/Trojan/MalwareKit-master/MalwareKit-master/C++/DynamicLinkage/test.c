#include <dlfcn.h>
#include <stdio.h>
#include <stdlib.h>

typedef void (*voidFPtr)();

int runLinkedFunction(char *libName, char *funcName);

int main(int argc, char **argv){
	if(argc == 3){
		runLinkedFunction(argv[1], argv[2]);
	}
	runLinkedFunction("liblink.so", "linkedFunction");
return 0;
}

int runLinkedFunction(char *libName, char *funcName){
	// open shared library
	void *lib = dlopen(libName, RTLD_NOW);
	if(lib == 0){
		// failed to open shared library
		printf("failed to open %s\n", libName);
		return -1;
	}
	int result = 0;
	void (*fPtr)() = (void*) dlsym(lib, funcName);
	char *err = dlerror();
	if(err == 0){
		// execute imported function
		fPtr();
	}else{
		// function lookup failed
		printf("failed to locate %s\n", funcName);
		result = -1;
	}
	dlclose(lib); 	// close library
	return result;
}
