#include <stdio.h>
#include <Windows.h>

#pragma comment(lib, "shell32.lib")

bool selfDelete();

// complie command cl file.cpp /link shell32.lib
int main(int arc, char **argv){
printf("about to destroy %s\n", argv[0]);

selfDelete();
}

bool selfDelete()
{
  TCHAR szFile[1024], szCmd[1024];

  if((GetModuleFileName(0,szFile,MAX_PATH)!=0) &&
     (GetShortPathName(szFile,szFile,MAX_PATH)!=0))
  {
    lstrcpy(szCmd,"/c del ");
    lstrcat(szCmd,szFile);
    lstrcat(szCmd," >> NUL");

    if((GetEnvironmentVariable("ComSpec",szFile,MAX_PATH)!=0) &&
       ((int)ShellExecute(0,0,szFile,szCmd,0,SW_HIDE)>32))
       return TRUE;
  }

  return FALSE;
}
