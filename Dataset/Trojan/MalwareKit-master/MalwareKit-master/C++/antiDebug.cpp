#include <windows.h>
#include <stdio.h>
#include <time.h>

bool myFunction();
bool detectVM();

char wordOne[] asm("word1") = "VMXh";
char wordTwo[] asm("word2") = "VX";

int WINAPI WinMain(HINSTANCE hThisInstance, HINSTANCE hPrevInstance,
                   LPSTR lpCmdLine, int nCmdShow)
{
  DWORD ticks = GetTickCount();
  printf("ticks: %lu\n", ticks);
  Sleep(1000);
  ticks = GetTickCount();
  printf("ticks: %lu\n", ticks);
  // if(detectVM()){
  //   MessageBox(0, "Were being watched, hide!", "Not Malware", MB_OK);
  // }else{
  //   MessageBox(0, "Hello User", "A Simple Windows Application", MB_OK);
  // }
return 0;
}

bool myFunction(){
  asm("movl %fs:0x18, %eax");
  asm("movl 0x30(%eax), %eax");
  asm("movzbl 0x2(%eax), %eax");
}

bool detectVM(){
  asm("movl word1, %eax");
  asm("movl $0x3C6CF712, %ebx");
  asm("movl $0x10, %ecx");
  asm("movw word2, %dx");
  try{
    asm("in %dx, %eax");
    asm("movl $0, %eax");
  }catch(int e){
    asm("movl $1, %eax");
  }
}
